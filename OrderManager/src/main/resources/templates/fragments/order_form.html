<!DOCTYPE html>
<html xmlns:th="">
<head></head>
<body>
    <div th:fragment="order-form(order)">
      <div class="form-group mb-3">
        <label for="exchangeId">Exchange</label>
        <select id="exchangeId" name="exchangeId" class="form-control" onchange="populateCompanyAbbrevs()">
          <option value="">Select an Exchange</option>
          <option th:each="key : ${exchangeCompanyAbbrevs.keySet()}" th:value="${key}" th:text="${key}"></option>
        </select>
      </div>

      <div class="form-group mb-3">
        <label for="companyAbbrev">Company Abbrev</label>
        <select id="companyAbbrev" name="companyAbbrev" class="form-control"></select>
      </div>

      <div class="form-group mb-3">
        <label for="numberOrdered">Quantity</label>
        <input type="text" id="numberOrdered" name="numberOrdered" class="form-control" th:value="${order.getNumberOrdered()}">
      </div>

      <div class="form-group mb-3">
        <label for="price">Price</label>
        <input type="text" id="price" name="price" class="form-control" th:value="${order.getPrice()}">
      </div>

      <div class="form-group mb-3">
        <label for="OrderType">Order Type</label>
        <select id="OrderType" name="OrderType" class="form-control">
          <option value="BUY">BUY</option>
          <option value="SELL">SELL</option>
        </select>
      </div>
    </div>

    <br />
    <script th:inline="javascript">
    function populateCompanyAbbrevs() {
        var exchangeIdSelect = document.getElementById("exchangeId");
        var companyAbbrevsSelect = document.getElementById("companyAbbrev");

        // Remove any existing options from the second select field
        while (companyAbbrevsSelect.firstChild) {
            companyAbbrevsSelect.removeChild(companyAbbrevsSelect.firstChild);
        }

        // Get the selected option from the first select field
        var selectedOption = exchangeIdSelect.options[exchangeIdSelect.selectedIndex].value;

        var exchangeCompanyAbbrevs = /*[[${exchangeCompanyAbbrevs}]]*/;

        // Get the values from the HashMap for the selected option
        var values = exchangeCompanyAbbrevs[selectedOption];

        // Add the values as options to the second select field
        for (var i = 0; i < values.length; i++) {
            var option = document.createElement("option");
            option.text = values[i];
            option.value = values[i];
            companyAbbrevsSelect.appendChild(option);
        }
    }
  </script>
  </div>
</body>
</html>